{% extends 'base.html' %}
{% load custom_filters %}

{% block title %}Excluir Turma: {{ turma.nome }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>Excluir Turma: {{ turma.nome }}</h1>

    <div class="alert alert-danger">
        <p>Você tem certeza que deseja excluir esta turma?</p>
        <p><strong>Atenção:</strong> Esta ação não pode ser desfeita.</p>
    </div>

    {% if dependencias %}
      <div class="alert alert-warning">
        <strong>Dependências encontradas:</strong>
        <ul>
          {% if dependencias.matriculas %}
            {% with matriculas_count=dependencias.matriculas|length %}
            {% if matriculas_count > 0 %}
            <li><b>Matrículas:</b> {{ matriculas_count }}
              <ul>
                {% for m in dependencias.matriculas|slice:":5" %}<li>{{ m }}</li>{% endfor %}
                {% if matriculas_count > 5 %}<li>... e mais {{ matriculas_count|subtract:5 }} matrícula(s)</li>{% endif %}
              </ul>
            </li>
            {% endif %}
            {% endwith %}
          {% endif %}
          {% if dependencias.atividades %}
            {% with atividades_count=dependencias.atividades|length %}
            {% if atividades_count > 0 %}
            <li><b>Atividades:</b> {{ atividades_count }}
              <ul>
                {% for a in dependencias.atividades|slice:":5" %}<li>{{ a }}</li>{% endfor %}
                {% if atividades_count > 5 %}<li>... e mais {{ atividades_count|subtract:5 }} atividade(s)</li>{% endif %}
              </ul>
            </li>
            {% endif %}
            {% endwith %}
          {% endif %}
          {% if dependencias.presencas %}
            {% with presencas_count=dependencias.presencas|length %}
            {% if presencas_count > 0 %}
            <li><b>Presenças:</b> {{ presencas_count }}</li>
            {% endif %}
            {% endwith %}
          {% endif %}
          {% if dependencias.notas %}
            {% with notas_count=dependencias.notas|length %}
            {% if notas_count > 0 %}
            <li><b>Notas:</b> {{ notas_count }}</li>
            {% endif %}
            {% endwith %}
          {% endif %}
          {% if dependencias.pagamentos %}
            {% with pagamentos_count=dependencias.pagamentos|length %}
            {% if pagamentos_count > 0 %}
            <li><b>Pagamentos:</b> {{ pagamentos_count }}</li>
            {% endif %}
            {% endwith %}
          {% endif %}
        </ul>
        <span class="text-danger">Remova todas as dependências acima para poder excluir esta turma.</span>
      </div>
    {% endif %}

    <form method="post">
        {% csrf_token %}
        <div class="d-flex justify-content-between">
            <a href="{% url 'turmas:detalhar_turma' turma.id %}" class="btn btn-secondary">
                <i class="fas fa-times"></i> Cancelar
            </a>
            <button type="submit" class="btn btn-danger">
                <i class="fas fa-trash"></i> Confirmar Exclusão
            </button>
        </div>
    </form>
</div>
{% endblock %}
