
{% extends 'base.html' %}

{% block title %}Lista de Cursos{% endblock %}

{% block content %}
<div class="container mt-4">
  <!-- Cabeçalho -->
  <div class="d-flex justify-content-between align-items-center mb-3">
      <h1>Lista de Cursos</h1>
      <div class="d-flex gap-2">
          <a href="{% url 'core:pagina_inicial' %}" class="btn btn-outline-secondary" data-bs-toggle="tooltip" title="Voltar">
              <i class="fas fa-arrow-left"></i> Voltar
          </a>
          <a href="{% url 'cursos:criar_curso' %}" class="btn btn-success" data-bs-toggle="tooltip" title="Novo Curso">
              <i class="fas fa-plus"></i> Novo Curso
          </a>
          <a href="{% url 'cursos:relatorio_cursos' %}" class="btn btn-outline-primary" data-bs-toggle="tooltip" title="Relatórios">
              <i class="fas fa-file-alt"></i> Relatórios
          </a>
          <a href="{% url 'cursos:importar_cursos' %}" class="btn btn-outline-success" data-bs-toggle="tooltip" title="Importar CSV">
              <i class="fas fa-file-import"></i> Importar CSV
          </a>
      </div>
  </div>
    
  <!-- Barra de busca -->
  <div class="card mb-4">
      <div class="card-header">
          <form method="get" class="row g-3">
              <div class="col-md-12">
                  <input type="text" name="q" id="filtro-cursos-input" class="form-control" placeholder="Buscar por nome..." value="{{ query|default:'' }}">
              </div>
          </form>
      </div>
      <div class="card-body">
          <div class="table-responsive">
              <table class="table table-striped table-hover">
                  <thead class="table-light">
                      <tr>
                          <th>Nome</th>
                          <th class="text-center">Ações</th>
                      </tr>
                  </thead>
                  <tbody id="cursos-tbody">
                      {% include 'cursos/partials/tabela_cursos.html' %}
                  </tbody>
              </table>
          </div>
      </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('filtro-cursos-input');
    const tableBody = document.getElementById('cursos-tbody');
    let timeout = null;

    searchInput.addEventListener('input', function (e) {
        const query = e.target.value;
        
        // Limpa o timeout anterior para evitar múltiplas requisições
        clearTimeout(timeout);

        // Define um novo timeout para fazer a busca após 300ms de inatividade
        timeout = setTimeout(() => {
            const url = `{% url 'cursos:listar_cursos' %}?q=${encodeURIComponent(query)}`;

            fetch(url, {
                method: 'GET',
                headers: {
                    'HX-Request': 'true'  // Header para o backend identificar a requisição AJAX
                }
            })
            .then(response => response.text())
            .then(html => {
                tableBody.innerHTML = html;
            })
            .catch(error => {
                console.error('Erro ao buscar cursos:', error);
                tableBody.innerHTML = '<tr><td colspan="2" class="text-center text-danger">Erro ao carregar os dados.</td></tr>';
            });
        }, 300);
    });
});
</script>
{% endblock %}
