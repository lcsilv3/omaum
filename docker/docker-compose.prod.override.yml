# ============================================================================
# OVERRIDE DE PRODU√á√ÉO
# ============================================================================
# Este arquivo sobrescreve configura√ß√µes do docker-compose.yml para PRODU√á√ÉO.
#
# ‚ö†Ô∏è  IMPORTANTE:
# - Prod usa portas 80 (Nginx) e 8000 (direto)
# - DJANGO_SETTINGS_MODULE=omaum.settings.production
# - Badge: üî¥ Vermelho "Ambiente de Produ√ß√£o"
#
# üìù Para subir o ambiente de produ√ß√£o:
#    docker compose --profile production -p omaum-prod \
#      --env-file ../.env.production \
#      -f docker-compose.yml \
#      -f docker-compose.prod.override.yml up -d
#
# üîê Este arquivo DEVE ser explicitamente especificado (-f)
#    N√ÉO renomeie para "docker-compose.override.yml" (seria lido automaticamente)
# ============================================================================

services:
  omaum-db:
    volumes:
      - D:/docker/omaum/prod/db:/var/lib/postgresql/data
  omaum-web:
    environment:
      - SECRET_KEY=${SECRET_KEY}
      - DEBUG=False
      - ALLOWED_HOSTS=${ALLOWED_HOSTS:-localhost,127.0.0.1}
      - DJANGO_SETTINGS_MODULE=omaum.settings.production
      - POSTGRES_DB=omaum_dev
      - POSTGRES_USER=omaum_user
      - POSTGRES_PASSWORD=omaum_password
    volumes:
      - ../:/app
      - D:/docker/omaum/prod/static:/app/static
      - D:/docker/omaum/prod/staticfiles:/app/staticfiles
      - D:/docker/omaum/prod/media:/app/media
      - D:/docker/omaum/prod/logs:/app/logs
    ports:
      # ‚ö†Ô∏è  PORTA 8000 (EXTERNA e INTERNA)
      # Prod exp√µe 8000 para:
      # 1. Nginx (proxy reverso na porta 80)
      # 2. Acesso direto para debug: http://localhost:8000
      - "8000:8000"
  omaum-redis:
    volumes:
      - D:/docker/omaum/prod/redis:/data
  omaum-celery:
    environment:
      - SECRET_KEY=${SECRET_KEY}
      - DEBUG=False
      - ALLOWED_HOSTS=${ALLOWED_HOSTS:-localhost,127.0.0.1}
      - DJANGO_SETTINGS_MODULE=omaum.settings.production
      - POSTGRES_DB=omaum_dev
      - POSTGRES_USER=omaum_user
      - POSTGRES_PASSWORD=omaum_password
    volumes:
      - ../:/app
      - D:/docker/omaum/prod/media:/app/media
      - D:/docker/omaum/prod/logs:/app/logs
