{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid">
  <h2 class="mt-3 mb-4">Relatório: Aniversariantes</h2>
  <form method="get" class="row g-2 mb-4 align-items-end" id="filtros-aniversariantes">
    <div class="col-md-4">
      <label for="filtro-mes" class="form-label">Mês</label>
      <select name="mes" id="filtro-mes" class="form-select">
        <option value="">Todos</option>
        {% for val, label in meses %}
          <option value="{{ val }}" {% if mes_filtro == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-8 d-flex gap-2 align-items-end">
      <button type="submit" class="btn btn-primary">Filtrar</button>
      <a href="?export=csv{% if mes_filtro %}&mes={{ mes_filtro }}{% endif %}" class="btn btn-outline-secondary" title="Exportar CSV"><i class="bi bi-file-earmark-spreadsheet"></i> CSV</a>
      <a href="?export=xls{% if mes_filtro %}&mes={{ mes_filtro }}{% endif %}" class="btn btn-outline-secondary" title="Exportar Excel"><i class="bi bi-file-earmark-excel"></i> Excel</a>
      <!-- Espaço reservado para integração futura (ex: envio de e-mail) -->
    </div>
  </form>

  <div class="table-responsive" style="overflow-x:auto;">
    <table class="table table-bordered table-hover align-middle small w-100" id="tabela-aniversariantes" style="min-width:900px;">
      <thead class="table-light">
        <tr>
          <th>Nome</th>
          <th>CPF</th>
          <th>Data Nasc.</th>
          <th>Email</th>
          <th>Telefone</th>
        </tr>
      </thead>
      <tbody>
        {% for aluno in alunos %}
        <tr>
          <td>{{ aluno.nome }}</td>
          <td>{{ aluno.cpf }}</td>
          <td>{{ aluno.data_nascimento|date:'d/m/Y' }}</td>
          <td>{{ aluno.email }}</td>
          <td>{{ aluno.celular_primeiro_contato|default:'-' }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="5" class="text-center">Nenhum aniversariante encontrado.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
