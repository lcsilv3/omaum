{% extends "base.html" %}
{% load static %}

{% block title %}{{ titulo }} - Alunos{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">{{ titulo }}</h3>
                    <div class="card-tools">
                        <a href="{% url 'alunos:listar_alunos_simple' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Voltar
                        </a>
                    </div>
                </div>
                
                <div class="card-body">
                    <form method="post" class="row g-3">
                        {% csrf_token %}
                        
                        <!-- Dados Pessoais -->
                        <div class="col-12">
                            <h5 class="text-primary">Dados Pessoais</h5>
                            <hr>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Nome Completo *</label>
                            {{ form.nome }}
                            {% if form.nome.errors %}
                                <div class="text-danger">{{ form.nome.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">CPF *</label>
                            {{ form.cpf }}
                            {% if form.cpf.errors %}
                                <div class="text-danger">{{ form.cpf.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Data de Nascimento</label>
                            {{ form.data_nascimento }}
                            {% if form.data_nascimento.errors %}
                                <div class="text-danger">{{ form.data_nascimento.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Hora de Nascimento</label>
                            {{ form.hora_nascimento }}
                            {% if form.hora_nascimento.errors %}
                                <div class="text-danger">{{ form.hora_nascimento.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Email</label>
                            {{ form.email }}
                            {% if form.email.errors %}
                                <div class="text-danger">{{ form.email.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Celular</label>
                            {{ form.celular_primeiro_contato }}
                            {% if form.celular_primeiro_contato.errors %}
                                <div class="text-danger">{{ form.celular_primeiro_contato.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Sexo</label>
                            {{ form.sexo }}
                            {% if form.sexo.errors %}
                                <div class="text-danger">{{ form.sexo.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Estado Civil</label>
                            {{ form.estado_civil }}
                            {% if form.estado_civil.errors %}
                                <div class="text-danger">{{ form.estado_civil.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <!-- Dados Iniciáticos -->
                        <div class="col-12 mt-4">
                            <h5 class="text-primary">Dados Iniciáticos</h5>
                            <hr>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Número Iniciático</label>
                            {{ form.numero_iniciatico }}
                            {% if form.numero_iniciatico.errors %}
                                <div class="text-danger">{{ form.numero_iniciatico.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Nome Iniciático</label>
                            {{ form.nome_iniciatico }}
                            {% if form.nome_iniciatico.errors %}
                                <div class="text-danger">{{ form.nome_iniciatico.errors }}</div>
                            {% endif %}
                        </div>
                        

                        
                        <div class="col-md-6">
                            <label class="form-label">Grau Atual (automático)</label>
                            {{ form.grau_atual_automatico }}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Grau Atual (manual)</label>
                            {{ form.grau_atual }}
                            {% if form.grau_atual.errors %}
                                <div class="text-danger">{{ form.grau_atual.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Situação Iniciática</label>
                            {{ form.situacao_iniciatica }}
                            {% if form.situacao_iniciatica.errors %}
                                <div class="text-danger">{{ form.situacao_iniciatica.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <!-- Endereço -->
                        <div class="col-12 mt-4">
                            <h5 class="text-primary">Endereço</h5>
                            <hr>
                        </div>
                        
                        <div class="col-md-8">
                            <label class="form-label">Rua/Endereço</label>
                            {{ form.rua }}
                            {% if form.rua.errors %}
                                <div class="text-danger">{{ form.rua.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-4">
                            <label class="form-label">CEP</label>
                            {{ form.cep }}
                            {% if form.cep.errors %}
                                <div class="text-danger">{{ form.cep.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Cidade</label>
                            {{ form.cidade }}
                            {% if form.cidade.errors %}
                                <div class="text-danger">{{ form.cidade.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">Estado</label>
                            {{ form.estado }}
                            {% if form.estado.errors %}
                                <div class="text-danger">{{ form.estado.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <!-- Adicionar Evento ao Histórico -->
                        <div class="col-12 mt-4">
                            <h5 class="text-success">Adicionar Evento ao Histórico (Opcional)</h5>
                            <hr>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">{{ form.novo_evento_tipo.label }}</label>
                            {{ form.novo_evento_tipo }}
                            {% if form.novo_evento_tipo.errors %}
                                <div class="text-danger">{{ form.novo_evento_tipo.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label">{{ form.novo_evento_data.label }}</label>
                            {{ form.novo_evento_data }}
                            {% if form.novo_evento_data.errors %}
                                <div class="text-danger">{{ form.novo_evento_data.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label">{{ form.novo_evento_descricao.label }}</label>
                            {{ form.novo_evento_descricao }}
                            {% if form.novo_evento_descricao.errors %}
                                <div class="text-danger">{{ form.novo_evento_descricao.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label">{{ form.novo_evento_observacoes.label }}</label>
                            {{ form.novo_evento_observacoes }}
                            {% if form.novo_evento_observacoes.errors %}
                                <div class="text-danger">{{ form.novo_evento_observacoes.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <!-- Botões -->
                        <div class="col-12 mt-4">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i>
                                <strong>Sistema v2.0:</strong> Formulário simplificado com botão de salvar funcionando corretamente.
                            </div>
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-save"></i> Salvar Dados do Aluno
                            </button>
                            <a href="{% url 'alunos:listar_alunos_simple' %}" class="btn btn-secondary btn-lg">
                                <i class="fas fa-arrow-left"></i> Voltar para Lista
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Validação automática de CPF
    const cpfInput = document.querySelector('input[name="cpf"]');
    if (cpfInput) {
        cpfInput.addEventListener('blur', function() {
            const cpf = this.value.replace(/\D/g, '');
            if (cpf.length === 11) {
                // Aqui você pode adicionar validação de CPF se necessário
                console.log('CPF válido:', cpf);
            }
        });
    }
    
    // Mostrar/ocultar campos de evento baseado no preenchimento
    const eventoTipo = document.querySelector('input[name="novo_evento_tipo"]');
    const eventoDescricao = document.querySelector('input[name="novo_evento_descricao"]');
    const eventoData = document.querySelector('input[name="novo_evento_data"]');
    
    function toggleEventoFields() {
        const hasValue = eventoTipo.value || eventoDescricao.value || eventoData.value;
        const eventSection = document.querySelector('.text-success').parentElement;
        
        if (hasValue) {
            eventSection.style.backgroundColor = '#f8f9fa';
            eventSection.style.border = '1px solid #28a745';
            eventSection.style.borderRadius = '5px';
            eventSection.style.padding = '10px';
        } else {
            eventSection.style.backgroundColor = '';
            eventSection.style.border = '';
            eventSection.style.borderRadius = '';
            eventSection.style.padding = '';
        }
    }
    
    if (eventoTipo) eventoTipo.addEventListener('input', toggleEventoFields);
    if (eventoDescricao) eventoDescricao.addEventListener('input', toggleEventoFields);
    if (eventoData) eventoData.addEventListener('input', toggleEventoFields);
});
</script>
{% endblock %}
