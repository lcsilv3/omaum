{% extends 'base.html' %}

{% block title %}Detalhes do Aluno: {{ aluno.nome }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Detalhes do Aluno</h1>
        <div>
            <a href="javascript:history.back()" class="btn btn-secondary me-2">Voltar</a>
            <a href="{% url 'alunos:editar_aluno' aluno.cpf %}" class="btn btn-warning me-2">Editar</a>
            <a href="{% url 'alunos:excluir_aluno' aluno.cpf %}" class="btn btn-danger">Excluir</a>
        </div>
    </div>
    
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    
    <div class="card mb-4">
        <div class="card-header">
            <h5>Dados Pessoais</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>CPF:</strong> {{ aluno.cpf }}</p>
                            <p><strong>Nome:</strong> {{ aluno.nome }}</p>
                            <p><strong>Data de Nascimento:</strong> {{ aluno.data_nascimento|date:"d/m/Y" }}</p>
                            <p><strong>Hora de Nascimento:</strong> {{ aluno.hora_nascimento|time:"H:i" }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Email:</strong> {{ aluno.email }}</p>
                            <p><strong>Sexo:</strong> {{ aluno.get_sexo_display }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <!-- Moldura tracejada azul brilhante sem cabeçalho -->
                    <div class="border rounded p-3 text-center" 
                         style="border-style: dashed !important; 
                                border-color: #007bff !important; 
                                border-width: 2px !important;
                                height: 200px; 
                                display: flex; 
                                align-items: center; 
                                justify-content: center;">
                        {% if aluno.foto %}
                            <img src="{{ aluno.foto.url }}" alt="Foto de {{ aluno.nome }}" 
                                 class="img-fluid rounded" 
                                 style="max-width: 120px; max-height: 160px; object-fit: cover;">
                        {% else %}
                            <div class="text-muted">Sem foto</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    {% if aluno.esta_ativo %}
    <div class="card mb-4">
        <div class="card-header">
            <h5>Instrutoria</h5>
        </div>
        <div class="card-body">
            {% if turmas_como_instrutor or turmas_como_instrutor_auxiliar or turmas_como_auxiliar_instrucao %}
                <div class="row">
                    {% if turmas_como_instrutor %}
                    <div class="col-md-4">
                        <h6 class="border-bottom pb-2">Como Instrutor Principal</h6>
                        <ul class="list-group">
                            {% for turma in turmas_como_instrutor %}
                            <li class="list-group-item">
                                <a href="{% url 'turmas:detalhar_turma' turma.id %}">{{ turma.nome }}</a>
                                <span class="badge bg-primary float-end">{{ turma.curso }}</span>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    
                    {% if turmas_como_instrutor_auxiliar %}
                    <div class="col-md-4">
                        <h6 class="border-bottom pb-2">Como Instrutor Auxiliar</h6>
                        <ul class="list-group">
                            {% for turma in turmas_como_instrutor_auxiliar %}
                            <li class="list-group-item">
                                <a href="{% url 'turmas:detalhar_turma' turma.id %}">{{ turma.nome }}</a>
                                <span class="badge bg-info float-end">{{ turma.curso }}</span>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    
                    {% if turmas_como_auxiliar_instrucao %}
                    <div class="col-md-4">
                        <h6 class="border-bottom pb-2">Como Auxiliar de Instrução</h6>
                        <ul class="list-group">
                            {% for turma in turmas_como_auxiliar_instrucao %}
                            <li class="list-group-item">
                                <a href="{% url 'turmas:detalhar_turma' turma.id %}">{{ turma.nome }}</a>
                                <span class="badge bg-success float-end">{{ turma.curso }}</span>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </div>
            {% else %}
                <p class="text-muted">Este aluno não é instrutor em nenhuma turma ativa.</p>
            {% endif %}
        </div>
    </div>
    {% endif %}
    
    <div class="card mb-4">
        <div class="card-header">
            <h5>Dados Iniciáticos</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Número Iniciático:</strong> {{ aluno.numero_iniciatico }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Nome Iniciático:</strong> {{ aluno.nome_iniciatico }}</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-header">
            <h5>Nacionalidade e Naturalidade</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Nacionalidade:</strong> {{ aluno.nacionalidade }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Naturalidade:</strong> {{ aluno.naturalidade }}</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-header">
            <h5>Endereço</h5>
        </div>
        <div class="card-body">
            <p><strong>Endereço Completo:</strong> {{ aluno.rua }}, {{ aluno.numero_imovel }}
                {% if aluno.complemento %}, {{ aluno.complemento }}{% endif %}
                - {{ aluno.bairro }}, {{ aluno.cidade }}/{{ aluno.estado }} - CEP: {{ aluno.cep }}</p>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-header">
            <h5>Contatos de Emergência</h5>
        </div>
        <div class="card-body">
            <h6>Primeiro Contato</h6>
            <p><strong>Nome:</strong> {{ aluno.nome_primeiro_contato }}</p>
            <p><strong>Celular:</strong> {{ aluno.celular_primeiro_contato }}</p>
            <p><strong>Relacionamento:</strong> {{ aluno.tipo_relacionamento_primeiro_contato }}</p>
            
            {% if aluno.nome_segundo_contato %}
                <h6 class="mt-3">Segundo Contato</h6>
                <p><strong>Nome:</strong> {{ aluno.nome_segundo_contato }}</p>
                <p><strong>Celular:</strong> {{ aluno.celular_segundo_contato }}</p>
                <p><strong>Relacionamento:</strong> {{ aluno.tipo_relacionamento_segundo_contato }}</p>
            {% endif %}
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-header">
            <h5>Informações Médicas</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3">
                    <p><strong>Tipo Sanguíneo:</strong> {{ aluno.tipo_sanguineo }}</p>
                </div>
                <div class="col-md-3">
                    <p><strong>Fator RH:</strong> {{ aluno.get_fator_rh_display }}</p>
                </div>
                <div class="col-md-3">
                    <p><strong>Convênio Médico:</strong> {{ aluno.convenio_medico|default:"Não informado" }}</p>
                </div>
                <div class="col-md-3">
                    <p><strong>Hospital:</strong> {{ aluno.hospital|default:"Não informado" }}</p>
                </div>
            </div>
            
            <div class="row mt-3">
                <div class="col-md-6">
                    <p><strong>Alergias:</strong> {{ aluno.alergias|default:"Nenhuma" }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Condições Médicas:</strong> {{ aluno.condicoes_medicas_gerais|default:"Nenhuma" }}</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="d-flex justify-content-between mb-5">
        <a href="{% url 'alunos:listar_alunos' %}" class="btn btn-secondary">Voltar para a lista</a>
        <div>
            <a href="{% url 'alunos:editar_aluno' aluno.cpf %}" class="btn btn-warning me-2">Editar</a>
            <a href="{% url 'alunos:excluir_aluno' aluno.cpf %}" class="btn btn-danger">Excluir</a>
        </div>
    </div>
</div>
{% endblock %}
