{% extends 'base.html' %}

{% block title %}Editar Aluno: {{ aluno.nome }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>Editar Aluno: {{ aluno.nome }}</h1>
    <form method="post" enctype="multipart/form-data" id="form-aluno" novalidate>
        {% csrf_token %}
        <!-- Seção: Dados Pessoais (recolhível, aberta por padrão) -->
        <div class="card mb-4 border-primary">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <a class="collapse-toggle text-white text-decoration-none" data-bs-toggle="collapse" href="#dados-pessoais" role="button" aria-expanded="true" aria-controls="dados-pessoais">
                        <span class="chevron">&#9654;</span> Dados Pessoais <small class="text-light">(clique para expandir/recolher)</small>
                    </a>
                </h5>
            </div>
            <div id="dados-pessoais" class="card-body collapse show">
                <div class="row">
                    <div class="col-md-6">
                        {% include 'includes/form_field.html' with field=form.cpf %}
                        {% include 'includes/form_field.html' with field=form.nome %}
                        {% include 'includes/form_field.html' with field=form.data_nascimento %}
                        {% include 'includes/form_field.html' with field=form.hora_nascimento %}
                    </div>
                    <div class="col-md-6">
                        {% include 'includes/form_field.html' with field=form.email %}
                        {% include 'includes/form_field.html' with field=form.sexo %}
                        {% include 'includes/form_field.html' with field=form.situacao %}
                    </div>
                </div>
            </div>
        </div>
        <!-- Seção: Dados Iniciáticos (recolhível, fechada por padrão) -->
        <div class="card mb-4 border-info">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <a class="collapse-toggle text-white text-decoration-none collapsed" data-bs-toggle="collapse" href="#dados-iniciaticos" role="button" aria-expanded="false" aria-controls="dados-iniciaticos">
                        <span class="chevron">&#9654;</span> Dados Iniciáticos <small class="text-light">(clique para expandir/recolher)</small>
                    </a>
                </h5>
            </div>
            <div id="dados-iniciaticos" class="card-body collapse">
                <div class="row">
                    <div class="col-md-6">
                        {% include 'includes/form_field.html' with field=form.numero_iniciatico %}
                    </div>
                    <div class="col-md-6">
                        {% include 'includes/form_field.html' with field=form.nome_iniciatico %}
                    </div>
                </div>
            </div>
        </div>
        <!-- Seção: Nacionalidade e Naturalidade (recolhível, fechada por padrão) -->
        <div class="card mb-4 border-secondary">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">
                    <a class="collapse-toggle text-white text-decoration-none collapsed" data-bs-toggle="collapse" href="#nacionalidade" role="button" aria-expanded="false" aria-controls="nacionalidade">
                        <span class="chevron">&#9654;</span> Nacionalidade e Naturalidade <small class="text-light">(clique para expandir/recolher)</small>
                    </a>
                </h5>
            </div>
            <div id="nacionalidade" class="card-body collapse">
                <div class="row">
                    <div class="col-md-6">
                        {% include 'includes/form_field.html' with field=form.nacionalidade %}
                    </div>
                    <div class="col-md-6">
                        {% include 'includes/form_field.html' with field=form.naturalidade %}
                    </div>
                </div>
            </div>
        </div>
        <!-- Seção: Endereço (recolhível, fechada por padrão) -->
        <div class="card mb-4 border-success">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <a class="collapse-toggle text-white text-decoration-none collapsed" data-bs-toggle="collapse" href="#endereco" role="button" aria-expanded="false" aria-controls="endereco">
                        <span class="chevron">&#9654;</span> Endereço <small class="text-light">(clique para expandir/recolher)</small>
                    </a>
                </h5>
            </div>
            <div id="endereco" class="card-body collapse">
                <div class="row">
                    <div class="col-md-8">
                        {% include 'includes/form_field.html' with field=form.rua %}
                    </div>
                    <div class="col-md-4">
                        {% include 'includes/form_field.html' with field=form.numero_imovel %}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        {% include 'includes/form_field.html' with field=form.complemento %}
                    </div>
                    <div class="col-md-4">
                        {% include 'includes/form_field.html' with field=form.bairro %}
                    </div>
                    <div class="col-md-4">
                        {% include 'includes/form_field.html' with field=form.cep %}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-8">
                        {% include 'includes/form_field.html' with field=form.cidade %}
                    </div>
                    <div class="col-md-4">
                        {% include 'includes/form_field.html' with field=form.estado %}
                    </div>
                </div>
            </div>
        </div>
        <!-- Seção: Contatos de Emergência (recolhível, fechada por padrão) -->
        <div class="card mb-4 border-warning">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                    <a class="collapse-toggle text-dark text-decoration-none collapsed" data-bs-toggle="collapse" href="#contatos" role="button" aria-expanded="false" aria-controls="contatos">
                        <span class="chevron">&#9654;</span> Contatos de Emergência <small class="text-muted">(clique para expandir/recolher)</small>
                    </a>
                </h5>
            </div>
            <div id="contatos" class="card-body collapse">
                <h6>Primeiro Contato</h6>
                <div class="row">
                    <div class="col-md-4">
                        {% include 'includes/form_field.html' with field=form.nome_primeiro_contato %}
                    </div>
                    <div class="col-md-4">
                        {% include 'includes/form_field.html' with field=form.celular_primeiro_contato %}
                    </div>
                    <div class="col-md-4">
                        {% include 'includes/form_field.html' with field=form.tipo_relacionamento_primeiro_contato %}
                    </div>
                </div>
                <h6 class="mt-3">Segundo Contato</h6>
                <div class="row">
                    <div class="col-md-4">
                        {% include 'includes/form_field.html' with field=form.nome_segundo_contato %}
                    </div>
                    <div class="col-md-4">
                        {% include 'includes/form_field.html' with field=form.celular_segundo_contato %}
                    </div>
                    <div class="col-md-4">
                        {% include 'includes/form_field.html' with field=form.tipo_relacionamento_segundo_contato %}
                    </div>
                </div>
            </div>
        </div>
        <!-- Seção: Informações Médicas (recolhível, fechada por padrão) -->
        <div class="card mb-4 border-danger">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0">
                    <a class="collapse-toggle text-white text-decoration-none collapsed" data-bs-toggle="collapse" href="#medicas" role="button" aria-expanded="false" aria-controls="medicas">
                        <span class="chevron">&#9654;</span> Informações Médicas <small class="text-light">(clique para expandir/recolher)</small>
                    </a>
                </h5>
            </div>
            <div id="medicas" class="card-body collapse">
                <div class="row">
                    <div class="col-md-3">
                        {% include 'includes/form_field.html' with field=form.tipo_sanguineo %}
                    </div>
                    <div class="col-md-3">
                        {% include 'includes/form_field.html' with field=form.convenio_medico %}
                    </div>
                    <div class="col-md-3">
                        {% include 'includes/form_field.html' with field=form.hospital %}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        {% include 'includes/form_field.html' with field=form.alergias %}
                    </div>
                    <div class="col-md-6">
                        {% include 'includes/form_field.html' with field=form.condicoes_medicas_gerais %}
                    </div>
                </div>
            </div>
        </div>
        <div class="mt-4">
            <button type="submit" class="btn btn-primary">Salvar Alterações</button>
            <a href="javascript:history.back()" class="btn btn-secondary">Voltar</a>
            <a href="{% url 'alunos:detalhar_aluno' aluno.cpf %}" class="btn btn-info">Cancelar</a>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Ícone de chevron rotaciona ao expandir/recolher
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.collapse-toggle').forEach(function(toggle) {
            toggle.addEventListener('click', function() {
                var chevron = this.querySelector('.chevron');
                setTimeout(function() {
                    if (toggle.classList.contains('collapsed')) {
                        chevron.style.transform = 'rotate(0deg)';
                    } else {
                        chevron.style.transform = 'rotate(90deg)';
                    }
                }, 150);
            });
        });
    });
</script>
{% endblock %}