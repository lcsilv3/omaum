{% extends 'alunos/base_relatorio.html' %}

{% block title %}{{ titulo }}{% endblock %}

{% block filtros %}
<form method="get" class="row g-3 mb-4 align-items-end" id="filtros-ficha-cadastral">
  <div class="col-md-3">
    <label for="filtro-aluno" class="form-label">Aluno</label>
    <select name="aluno" id="filtro-aluno" class="form-select">
      <option value="">Todos</option>
      {% for aluno_filtro in todos_alunos %}
        <option value="{{ aluno_filtro.id }}" {% if filtros.aluno_id == aluno_filtro.id|stringformat:'s' %}selected{% endif %}>{{ aluno_filtro.nome }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <label for="filtro-turma" class="form-label">Turma</label>
    <select name="turma" id="filtro-turma" class="form-select">
      <option value="">Todas</option>
      {% for turma in turmas %}
        <option value="{{ turma.id }}" {% if filtros.turma_id == turma.id|stringformat:'s' %}selected{% endif %}>{{ turma.nome }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <label for="filtro-curso" class="form-label">Curso</label>
    <select name="curso" id="filtro-curso" class="form-select">
      <option value="">Todos</option>
      {% for curso in cursos %}
        <option value="{{ curso.id }}" {% if filtros.curso_id == curso.id|stringformat:'s' %}selected{% endif %}>{{ curso.nome }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <label for="filtro-situacao" class="form-label">Situação</label>
    <select name="situacao" id="filtro-situacao" class="form-select">
      <option value="">Todas</option>
      {% for val, label in situacoes %}
        <option value="{{ val }}" {% if filtros.situacao == val %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-3 d-flex align-items-end gap-2">
    <button type="submit" class="btn btn-primary w-100">Filtrar</button>
  </div>
</form>
{% endblock filtros %}

{% block relatorio_content %}
<div class="table-responsive">
  <table class="table table-bordered table-hover align-middle small w-100">
    <thead class="table-light">
      <tr>
        <th>Nome</th>
        <th>CPF</th>
        <th>Data Nasc.</th>
        <th>Email</th>
        <th>Situação</th>
      </tr>
    </thead>
    <tbody>
      {% for aluno in alunos %}
      <tr>
        <td>{{ aluno.nome }}</td>
        <td>{{ aluno.cpf }}</td>
        <td>{{ aluno.data_nascimento|date:'d/m/Y' }}</td>
        <td>{{ aluno.email }}</td>
        <td>
          <span class="badge {% if aluno.situacao == 'a' %}bg-success{% else %}bg-secondary{% endif %}">
            {{ aluno.get_situacao_display }}
          </span>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="5" class="text-center">Nenhum aluno encontrado com os filtros aplicados.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock relatorio_content %}
