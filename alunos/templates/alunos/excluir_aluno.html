{% extends 'base.html' %}

{% block title %}Excluir Aluno: {{ aluno.nome }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <h1>Excluir Aluno: {{ aluno.nome }}</h1>

  <div class="alert alert-danger">
      <p>Você tem certeza que deseja excluir o aluno "{{ aluno.nome }}"?</p>
      <p><strong>Atenção:</strong> Esta ação não pode ser desfeita.</p>
  </div>

  {% if dependencias %}
    <div class="alert alert-warning">
      <strong>Dependências encontradas:</strong>
      <ul>
        {% if dependencias.matriculas and dependencias.matriculas|length > 0 %}
          <li><b>Matrículas:</b> {{ dependencias.matriculas|length }}
            <ul>
              {% for m in dependencias.matriculas|slice:":5" %}<li>{{ m }}</li>{% endfor %}
              {% if dependencias.matriculas|length > 5 %}<li>... e mais {{ dependencias.matriculas|length|add:"-5" }} matrícula(s)</li>{% endif %}
            </ul>
          </li>
        {% endif %}
        {% if dependencias.notas and dependencias.notas|length > 0 %}
          <li><b>Notas:</b> {{ dependencias.notas|length }}
            <ul>
              {% for n in dependencias.notas|slice:":5" %}<li>{{ n }}</li>{% endfor %}
              {% if dependencias.notas|length > 5 %}<li>... e mais {{ dependencias.notas|length|add:"-5" }} nota(s)</li>{% endif %}
            </ul>
          </li>
        {% endif %}
        {% if dependencias.presencas and dependencias.presencas|length > 0 %}
          <li><b>Presenças:</b> {{ dependencias.presencas|length }}</li>
        {% endif %}
        {% if dependencias.pagamentos and dependencias.pagamentos|length > 0 %}
          <li><b>Pagamentos:</b> {{ dependencias.pagamentos|length }}</li>
        {% endif %}
        {% if dependencias.punicoes and dependencias.punicoes|length > 0 %}
          <li><b>Punições:</b> {{ dependencias.punicoes|length }}</li>
        {% endif %}
      </ul>
      <span class="text-danger">Remova todas as dependências acima para poder excluir este aluno.</span>
    </div>
  {% endif %}

  <form method="post">
      {% csrf_token %}
      <div class="d-flex justify-content-between">
          <a href="{% url 'alunos:detalhar_aluno' aluno.cpf %}" class="btn btn-secondary">Cancelar (CPF: {{ aluno.cpf|mask_cpf }})
              <i class="fas fa-times"></i> Cancelar
          </a>
          <button type="submit" class="btn btn-danger" {% if dependencias.matriculas|length > 0 or dependencias.notas|length > 0 or dependencias.presencas|length > 0 or dependencias.pagamentos|length > 0 or dependencias.punicoes|length > 0 %}disabled{% endif %}>
              <i class="fas fa-trash"></i> Confirmar Exclusão
          </button>
      </div>
  </form>
</div>
{% endblock %}
