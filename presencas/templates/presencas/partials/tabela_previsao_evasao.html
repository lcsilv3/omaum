{% if alunos %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>Aluno</th>
                <th>Turma</th>
                <th>Score de Risco</th>
                <th>Classificação</th>
                <th>Tendência</th>
                <th>Última Presença</th>
                <th>Previsão</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for aluno in alunos %}
            <tr class="{% if aluno.score_risco >= 80 %}risco-critico{% elif aluno.score_risco >= 60 %}risco-alto{% elif aluno.score_risco >= 40 %}risco-medio{% else %}risco-baixo{% endif %}">
                <td>
                    <strong>{{ aluno.nome }}</strong><br>
                    <small class="text-muted">{{ aluno.email|default:"Sem email" }}</small>
                </td>
                <td>{{ aluno.turma }}</td>
                <td>
                    <span class="score-badge bg-{% if aluno.score_risco >= 80 %}danger{% elif aluno.score_risco >= 60 %}warning text-dark{% elif aluno.score_risco >= 40 %}info{% else %}success{% endif %}">
                        {{ aluno.score_risco|floatformat:1 }}%
                    </span>
                </td>
                <td>
                    {% if aluno.score_risco >= 80 %}
                        <span class="badge bg-danger">Crítico</span>
                    {% elif aluno.score_risco >= 60 %}
                        <span class="badge bg-warning text-dark">Alto</span>
                    {% elif aluno.score_risco >= 40 %}
                        <span class="badge bg-info">Médio</span>
                    {% else %}
                        <span class="badge bg-success">Baixo</span>
                    {% endif %}
                </td>
                <td>
                    {% if aluno.tendencia > 0 %}
                        <i class="fas fa-arrow-up text-success"></i> Melhorando
                    {% elif aluno.tendencia < 0 %}
                        <i class="fas fa-arrow-down text-danger"></i> Piorando
                    {% else %}
                        <i class="fas fa-arrow-right text-warning"></i> Estável
                    {% endif %}
                </td>
                <td>
                    {{ aluno.ultima_presenca|default:"N/A" }}
                    {% if aluno.dias_ausente %}
                        <br><small class="text-danger">{{ aluno.dias_ausente }} dias ausente</small>
                    {% endif %}
                </td>
                <td>
                    <small>
                        {% if aluno.probabilidade_evasao %}
                            {{ aluno.probabilidade_evasao|floatformat:1 }}% chance de evasão
                        {% else %}
                            Dados insuficientes
                        {% endif %}
                    </small>
                </td>
                <td>
                    <div class="btn-group btn-group-sm">
                        <button type="button" class="btn btn-outline-primary" title="Ver detalhes">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button type="button" class="btn btn-outline-warning" title="Contatar">
                            <i class="fas fa-phone"></i>
                        </button>
                        <button type="button" class="btn btn-outline-info" title="Intervenção">
                            <i class="fas fa-user-md"></i>
                        </button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="mt-3">
    <p class="text-muted">
        <i class="fas fa-info-circle"></i> 
        Encontrados {{ alunos|length }} aluno{{ alunos|length|pluralize }} analisado{{ alunos|length|pluralize }}.
        Algoritmo de ML baseado em padrões de presença, tendências e fatores de risco.
    </p>
</div>
{% else %}
<div class="text-center py-5">
    <i class="fas fa-robot fa-3x text-muted mb-3"></i>
    <h5>Nenhum dado encontrado</h5>
    <p class="text-muted">
        Não há dados suficientes para análise preditiva com os filtros selecionados.<br>
        Tente ajustar os critérios ou aguarde mais dados históricos.
    </p>
</div>
{% endif %}
