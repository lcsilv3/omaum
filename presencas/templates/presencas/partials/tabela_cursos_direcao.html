{% if dados_cursos %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>Curso</th>
                <th>Total Alunos</th>
                <th>Total Turmas</th>
                <th>Presença Média</th>
                <th>Total Carências</th>
                <th>Taxa Carências</th>
                <th>Status</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for curso in dados_cursos %}
            <tr class="{% if curso.presenca_media < 60 %}table-danger{% elif curso.presenca_media < 75 %}table-warning{% elif curso.presenca_media >= 90 %}table-success{% endif %}">
                <td>
                    <strong>{{ curso.turma__curso__nome }}</strong><br>
                    <small class="text-muted">ID: {{ curso.turma__curso__id }}</small>
                </td>
                <td>
                    <span class="badge bg-primary rounded-pill">{{ curso.total_alunos|default:0 }}</span>
                </td>
                <td>{{ curso.total_turmas|default:0 }}</td>
                <td>
                    <div class="d-flex align-items-center">
                        <div class="progress me-2" style="width: 70px; height: 20px;">
                            <div class="progress-bar bg-{% if curso.presenca_media >= 85 %}success{% elif curso.presenca_media >= 75 %}info{% elif curso.presenca_media >= 60 %}warning{% else %}danger{% endif %}" 
                                 style="width: {{ curso.presenca_media|default:0 }}%">
                            </div>
                        </div>
                        <span class="small">{{ curso.presenca_media|floatformat:1 }}%</span>
                    </div>
                </td>
                <td>
                    <span class="badge bg-{% if curso.total_carencias > 50 %}danger{% elif curso.total_carencias > 20 %}warning text-dark{% else %}success{% endif %}">
                        {{ curso.total_carencias|default:0 }}
                    </span>
                </td>
                <td>{{ curso.taxa_carencias|floatformat:1 }}%</td>
                <td>
                    {% if curso.presenca_media >= 90 %}
                        <span class="badge bg-success">Excelente</span>
                    {% elif curso.presenca_media >= 75 %}
                        <span class="badge bg-info">Bom</span>
                    {% elif curso.presenca_media >= 60 %}
                        <span class="badge bg-warning text-dark">Regular</span>
                    {% else %}
                        <span class="badge bg-danger">Crítico</span>
                    {% endif %}
                </td>
                <td>
                    <div class="btn-group btn-group-sm">
                        <button type="button" class="btn btn-outline-primary" title="Relatório detalhado">
                            <i class="fas fa-chart-bar"></i>
                        </button>
                        <button type="button" class="btn btn-outline-info" title="Intervenções">
                            <i class="fas fa-tools"></i>
                        </button>
                        {% if curso.presenca_media < 75 %}
                        <button type="button" class="btn btn-outline-warning" title="Plano de ação">
                            <i class="fas fa-exclamation-triangle"></i>
                        </button>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="mt-3">
    <div class="row">
        <div class="col-md-8">
            <div class="alert alert-info">
                <i class="fas fa-info-circle"></i> 
                <strong>Análise Executiva:</strong> 
                {{ dados_cursos|length }} curso{{ dados_cursos|length|pluralize }} analisado{{ dados_cursos|length|pluralize }}.
                
                {% with criticos=dados_cursos|length %}
                {% if criticos > 0 %}
                    {% for curso in dados_cursos %}
                        {% if curso.presenca_media < 60 %}
                            Curso {{ curso.turma__curso__nome }} requer atenção imediata da direção.
                        {% endif %}
                    {% endfor %}
                {% else %}
                    Todos os cursos estão dentro dos parâmetros aceitáveis.
                {% endif %}
                {% endwith %}
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-light">
                <div class="card-body text-center">
                    <h6>Metas Institucionais</h6>
                    <small class="text-muted">
                        Presença: ≥75%<br>
                        Carências: ≤15%<br>
                        Qualidade: ≥85%
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="text-center py-5">
    <i class="fas fa-graduation-cap fa-3x text-muted mb-3"></i>
    <h5>Nenhum curso encontrado</h5>
    <p class="text-muted">
        Não há dados de cursos disponíveis para o período selecionado.<br>
        Verifique os filtros ou aguarde a coleta de dados.
    </p>
</div>
{% endif %}
