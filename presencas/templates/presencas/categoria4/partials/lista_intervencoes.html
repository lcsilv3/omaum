{% if sucesso and intervencoes %}

<!-- Intervenções Críticas -->
{% if intervencoes.criticas %}
<div class="mb-4">
    <h6 class="text-danger"><i class="fas fa-exclamation-triangle"></i> INTERVENÇÕES CRÍTICAS (24h)</h6>
    {% for item in intervencoes.criticas %}
    <div class="card mb-2 intervencao-critica">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <strong>{{ item.nome }}</strong>
                    <br><small class="text-muted">{{ item.turma }}</small>
                </div>
                <div class="col-md-2 text-center">
                    <span class="badge bg-danger fs-6">{{ item.score_risco }}</span>
                    <br><small>Score Risco</small>
                </div>
                <div class="col-md-3">
                    <strong class="text-danger">{{ item.acao_sugerida }}</strong>
                    <br><small class="prazo-urgente">{{ item.prazo }}</small>
                </div>
                <div class="col-md-2">
                    <small><strong>Responsável:</strong><br>{{ item.responsavel }}</small>
                </div>
                <div class="col-md-2 text-end">
                    <button class="btn btn-danger btn-sm" onclick="marcarIntervencao({{ item.aluno_id }}, 'critica')">
                        <i class="fas fa-check"></i> Executar
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Intervenções Altas -->
{% if intervencoes.altas %}
<div class="mb-4">
    <h6 class="text-warning"><i class="fas fa-exclamation"></i> INTERVENÇÕES ALTAS (3 dias)</h6>
    {% for item in intervencoes.altas %}
    <div class="card mb-2 intervencao-alta">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <strong>{{ item.nome }}</strong>
                    <br><small class="text-muted">{{ item.turma }}</small>
                </div>
                <div class="col-md-2 text-center">
                    <span class="badge bg-warning fs-6">{{ item.score_risco }}</span>
                    <br><small>Score Risco</small>
                </div>
                <div class="col-md-3">
                    <strong class="text-warning">{{ item.acao_sugerida }}</strong>
                    <br><small class="prazo-medio">{{ item.prazo }}</small>
                </div>
                <div class="col-md-2">
                    <small><strong>Responsável:</strong><br>{{ item.responsavel }}</small>
                </div>
                <div class="col-md-2 text-end">
                    <button class="btn btn-warning btn-sm" onclick="marcarIntervencao({{ item.aluno_id }}, 'alta')">
                        <i class="fas fa-calendar-plus"></i> Agendar
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Intervenções Médias -->
{% if intervencoes.medias %}
<div class="mb-4">
    <h6 class="text-info"><i class="fas fa-info-circle"></i> INTERVENÇÕES MÉDIAS (1 semana)</h6>
    {% for item in intervencoes.medias %}
    <div class="card mb-2 intervencao-media">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <strong>{{ item.nome }}</strong>
                    <br><small class="text-muted">{{ item.turma }}</small>
                </div>
                <div class="col-md-2 text-center">
                    <span class="badge bg-info fs-6">{{ item.score_risco }}</span>
                    <br><small>Score Risco</small>
                </div>
                <div class="col-md-3">
                    <strong class="text-info">{{ item.acao_sugerida }}</strong>
                    <br><small class="prazo-normal">{{ item.prazo }}</small>
                </div>
                <div class="col-md-2">
                    <small><strong>Responsável:</strong><br>{{ item.responsavel }}</small>
                </div>
                <div class="col-md-2 text-end">
                    <button class="btn btn-info btn-sm" onclick="marcarIntervencao({{ item.aluno_id }}, 'media')">
                        <i class="fas fa-eye"></i> Monitorar
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Ações Preventivas -->
{% if intervencoes.preventivas %}
<div class="mb-4">
    <h6 class="text-success"><i class="fas fa-shield-alt"></i> AÇÕES PREVENTIVAS (2 semanas)</h6>
    {% for item in intervencoes.preventivas %}
    <div class="card mb-2 intervencao-preventiva">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <strong>{{ item.nome }}</strong>
                    <br><small class="text-muted">{{ item.turma }}</small>
                </div>
                <div class="col-md-2 text-center">
                    <span class="badge bg-success fs-6">{{ item.score_risco }}</span>
                    <br><small>Score Risco</small>
                </div>
                <div class="col-md-3">
                    <strong class="text-success">{{ item.acao_sugerida }}</strong>
                    <br><small class="prazo-normal">{{ item.prazo }}</small>
                </div>
                <div class="col-md-2">
                    <small><strong>Responsável:</strong><br>{{ item.responsavel }}</small>
                </div>
                <div class="col-md-2 text-end">
                    <button class="btn btn-success btn-sm" onclick="marcarIntervencao({{ item.aluno_id }}, 'preventiva')">
                        <i class="fas fa-plus"></i> Adicionar
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Resumo de Ações -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card bg-light">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-clipboard-check"></i> Resumo de Ações Recomendadas</h6>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-3">
                        <div class="h4 text-danger">{{ intervencoes.criticas|length }}</div>
                        <small>Ações Imediatas</small>
                    </div>
                    <div class="col-md-3">
                        <div class="h4 text-warning">{{ intervencoes.altas|length }}</div>
                        <small>Ações Urgentes</small>
                    </div>
                    <div class="col-md-3">
                        <div class="h4 text-info">{{ intervencoes.medias|length }}</div>
                        <small>Monitoramento</small>
                    </div>
                    <div class="col-md-3">
                        <div class="h4 text-success">{{ intervencoes.preventivas|length }}</div>
                        <small>Prevenção</small>
                    </div>
                </div>
                <hr>
                <div class="text-center">
                    <small class="text-muted">
                        <i class="fas fa-robot"></i> 
                        Análise gerada automaticamente pelo sistema de IA - 
                        Total de {{ estatisticas.total_intervencoes }} intervenções sugeridas
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function marcarIntervencao(alunoId, categoria) {
        // Implementar lógica para marcar intervenção como executada
        // Por exemplo, fazer uma requisição AJAX para registrar a ação
        
        if (confirm(`Confirma que a intervenção para o aluno ${alunoId} foi executada?`)) {
            // Aqui seria feita a requisição para o backend
            alert('Intervenção registrada com sucesso!');
            
            // Opcional: remover o item da lista ou marcar como concluído
            event.target.closest('.card').style.opacity = '0.5';
            event.target.innerHTML = '<i class="fas fa-check"></i> Concluído';
            event.target.disabled = true;
        }
    }
</script>

{% elif not sucesso %}
<div class="alert alert-warning">
    <i class="fas fa-exclamation-triangle"></i>
    <strong>Erro no sistema de IA:</strong>
    {{ estatisticas.erro|default:"Erro desconhecido no processamento das intervenções automáticas." }}
</div>
{% else %}
<div class="alert alert-success text-center">
    <i class="fas fa-check-circle"></i>
    <strong>Nenhuma intervenção necessária</strong>
    <br>
    <small>O sistema de IA não identificou necessidade de intervenções no momento. Situação sob controle!</small>
</div>
{% endif %}
